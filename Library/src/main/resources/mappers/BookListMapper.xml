<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.domain.user.BookInfoRepository">

	<!-- 책 리스트 총 갯수 조회 쿼리 -->
	<select id="bookListTotalCount" parameterType="com.example.demo.domain.user.BookInfoRepository"  resultType="integer">

	SELECT 
		COUNT(*)
	FROM
		TB_LIB
	
	</select>
	
	<!-- 책 정보 조회 쿼리 -->
	<select id="getBookList" resultType="com.example.demo.domain.book.BookBoard">

  	   SELECT 
 		KEY_NUM,
 		LOCATION,
 		REF_ROOM,
 		BOOK_NAME,
 		AUTHOR,
 		PUBLISHER,
 		BOOK_IMG,
 		YR_PUBLICATION
	  FROM
		TB_LIB	
	</select> 
	
	<select id="BookShowInfoBoard" resultType="com.example.demo.domain.book.BookShowInfo">
  	   SELECT 
 		*
	  FROM
		TB_LIB
	  WHERE 
	  	BOOK_NAME = #{bookname}	
	</select> 
	
	
	
	
	
	<!-- 사용자가 검색한 책 정보 조회 -->
	<select id="getBookSearchList" resultType="com.example.demo.domain.book.BookSearch">
		 SELECT 
   			BOOK_NAME,
   			AUTHOR,
   			PUBLISHER,
 			LOCATION,
 			CALL_SIGN
		FROM
			TB_LIB
		WHERE
			BOOK_NAME LIKE CONCAT('%',#{keyword},'%') OR AUTHOR LIKE CONCAT('%',#{keyword}, '%');

	</select>
	
	<!-- 사용자가 검색한 책 갯수 -->
	<select id="bookSearchTotalCount" parameterType="com.example.demo.domain.user.BookInfoRepository"  resultType="integer">

	SELECT 
		COUNT(*)
	FROM
		TB_LIB
	WHERE
		BOOK_NAME LIKE CONCAT('%',#{keyword},'%') OR AUTHOR LIKE CONCAT('%',#{keyword}, '%');
	
	</select>
	
	<!-- 대출한책 insert 날리기 -->
	<insert id="insertBorrowBoard" parameterType="com.example.demo.domain.book.BookBorrowBoard">
		insert into
			TB_LOAN
		values(
		0,
		#{bookname},
		#{bookauthor},
		#{bookpublisher},
		#{booklocation},
		#{user_key},
		now(),
		now()
		
		)
	</insert>
	
	
</mapper>
  